<!DOCTYPE html>
<html lang="th">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ตารางเรียน ม.5/1</title>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background-image: url('jpcity.jfif');
      background-size: cover;
      background-position: center;
      background-attachment: fixed;
      padding: 20px;
      margin: 0;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    /* วางนาฬิกาจริง + นาฬิกานับถอยหลัง ข้างกัน */
    .clocks {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
      justify-content: center;
      width: 100%;
      max-width: 1000px;
      margin-bottom: 8px;
    }

    /* UI text shadow (ไม่ไปยุ่งกับตัวอักษรในตาราง) */
    .ui-shadow { text-shadow: 0 1px 3px #000; }

    h1 {
      text-align: center;
      color: #fff;
      margin-bottom: 12px;
    }
    h1.ui-shadow { text-shadow: 0 2px 6px #000; }

    .digital-clock {
      font-size: 2rem;
      color: cyan;
      font-family: 'Courier New', Courier, monospace;
      background: rgba(0, 0, 0, 0.7);
      padding: 10px 20px;
      border-radius: 10px;
      box-shadow: 0 0 20px cyan;
      min-width: 240px;
      text-align: center;
    }

    /* นาฬิกานับถอยหลัง ใช้หน้าตาเดียวกับ digital-clock */
    .countdown-clock {
      font-size: 2rem;
      color: #ff3b30; /* เริ่มต้นเป็นแดง (นอก 10 นาที) */
      box-shadow: 0 0 20px rgba(255,59,48,0.9);
    }

    @keyframes blink {
      0%, 49%   { opacity: 1; }
      50%, 100% { opacity: 0.25; }
    }
    .blink {
      animation: blink 1s steps(2, start) infinite;
    }

    .current-subject {
      font-size: 1.2rem;
      margin-top: 6px;
      margin-bottom: 12px;
      color: white;
      background-color: rgba(0, 0, 0, 0.6);
      padding: 10px;
      border-radius: 10px;
      text-align: center;
      box-shadow: 0 0 10px white;
    }

    /* กล่องสถานะ/แถบความคืบหน้า */
    .progress-wrap {
      width: 100%;
      max-width: 1000px;
      display: grid;
      gap: 10px;
      margin-bottom: 14px;
    }

    .progress-block {
      background: rgba(255, 255, 255, 0.4);
      border: 1px solid rgba(255, 255, 255, 0.6);
      border-radius: 10px;
      padding: 10px;
      box-shadow: 0 6px 16px rgba(0,0,0,0.12);
      backdrop-filter: blur(3px);
      transition: box-shadow 0.25s ease;
    }

    .progress-title {
      font-weight: 700;
      margin-bottom: 6px;
      color: #fff;
    }

    .progress-subtitle {
      font-size: 0.95rem;
      margin-bottom: 6px;
      color: #fff;
    }

    .progress-subnote {
      font-size: 0.9rem;
      color: #e9f6ff;
      opacity: 0.95;
      margin-top: -2px;
      margin-bottom: 6px;
    }

    .progress-bar {
      width: 100%;
      height: 12px;
      border-radius: 999px;
      background: rgba(0,0,0,0.15);
      overflow: hidden;
      position: relative;
    }

    .progress-fill {
      height: 100%;
      width: 0%;
      background: linear-gradient(90deg, rgba(79,129,199,1), rgba(0,132,255,1));
      border-radius: 999px;
      transition: width 0.3s ease;
    }

    .progress-time {
      margin-top: 6px;
      font-size: 0.9rem;
      color: #03dffc;
    }

    /* ตาราง (คงเดิม ไม่ใส่เงาอักษร) */
    table {
      border-collapse: collapse;
      width: 100%;
      table-layout: fixed;
      background: rgba(255, 255, 255, 0.4);
      border-radius: 10px;
      overflow: hidden;
      box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
    }
    th, td {
      border: 1px solid rgba(255, 255, 255, 0.6);
      padding: 12px;
      text-align: center;
      background-color: rgba(255, 255, 255, 0.4);
      text-shadow: none;
    }
    th { background-color: #4f81c7; color: white; }

    .highlighted {
      background-color: rgba(0, 132, 255, 0.4) !important;
      transform: scale(1.1);
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.15);
      z-index: 1;
      position: relative;
    }

    @media (max-width: 768px) {
      table { font-size: 0.9rem; }
      .progress-title, .progress-subtitle, .progress-time, .progress-subnote { text-align: center; }
      .digital-clock, .countdown-clock { min-width: 200px; width: 100%; }
    }
  </style>
</head>

<body>
  <h1 class="ui-shadow">ตารางเรียน ม.5/1 กลุ่ม 3 ภาคเรียนที่ 2/2568</h1>

  <!-- แถวแสดงนาฬิกา: เวลาปัจจุบัน + นับถอยหลัง -->
  <div class="clocks">
    <div class="digital-clock ui-shadow" id="digital-clock">00:00:00</div>
    <div class="digital-clock ui-shadow countdown-clock" id="countdown-clock">--:--</div>
  </div>

  <!-- กล่องสถานะและคาบถัดไป (เหมือนเดิม แต่อยู่โดยไม่มี countdown ข้างในแล้ว) -->
  <div class="progress-wrap">
    <div class="progress-block" id="current-block">
      <div class="progress-title ui-shadow">ช่วงเวลาปัจจุบัน</div>
      <div class="progress-subtitle ui-shadow" id="current-slot-label">ขณะนี้ไม่มีคาบเรียน</div>
      <div class="progress-bar"><div class="progress-fill" id="current-progress"></div></div>
      <div class="progress-time ui-shadow" id="current-time-eta"></div>
    </div>

    <div class="progress-block" id="next-block">
      <div class="progress-title ui-shadow">คาบ/ช่วงถัดไป</div>
      <div class="progress-subtitle ui-shadow" id="next-slot-label">-</div>
      <div class="progress-subnote ui-shadow" id="next-after" style="display:none;">-</div>
      <div class="progress-bar"><div class="progress-fill" id="next-progress"></div></div>
      <div class="progress-time ui-shadow" id="next-time-eta">เริ่มเวลา --:--</div>
    </div>
  </div>

  <div class="current-subject ui-shadow" id="current-subject">ขณะนี้ไม่มีคาบเรียน</div>

  <!-- ตารางเดิม -->
  <table>
    <thead>
      <tr>
        <th>วัน/เวลา</th>
        <th>08.30-09.20</th>
        <th>09.20-10.10</th>
        <th>10.20-11.10</th>
        <th>11.10-12.00</th>
        <th>12.00-12.50</th>
        <th>12.50-13.40</th>
        <th>13.50-14.40</th>
        <th>14.40-15.30</th>
        <th>15.30-16.20</th>
        <th>16.20-17.10</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <th>จันทร์</th>
        <td>คณิตศาสตร์เพิ่ม<br>ครูภณิตา<br>232</td>
        <td>คณิตศาสตร์เพิ่ม<br>ครูภณิตา<br>232</td>
        <td>Ind Study<br>ครูอชิร<br>332</td>
        <td>Ind Study<br>ครูอชิร<br>332</td>
        <td>พักกลางวัน<br>โรงอาหาร</td>
        <td>เคมีเพิ่มเติม<br>ครูกัลยา<br>432</td>
        <td>เคมีเพิ่มเติม<br>ครูกัลยา<br>432</td>
        <td>การงานอาชีพ<br>ร้อยตรีวัชชัย<br>ฝึกงาน2</td>
        <td>-</td><td>-</td>
      </tr>
      <tr>
        <th>อังคาร</th>
        <td>วิทยาศาสตร์โลกและอวกาศ<br>ครูพงศกร(เพชร)<br>433</td>
        <td>วิทยาศาสตร์โลกและอวกาศ<br>ครูพงศกร(เพชร)<br>433</td>
        <td>เคมีเพิ่มเติม<br>ครูกัลยา<br>432</td>
        <td>ชีวะเพิ่ม<br>ครูเจษฎา<br>213</td>
        <td>พักกลางวัน<br>โรงอาหาร</td>
        <td>ภาษาไทย<br>ครูอรทัย<br>627</td>
        <td>คณิตศาสตร์<br>ครูวินัย<br>234</td>
        <td>สุขะพละ<br>ครูนฤมิต<br>อเนกประสงค์5</td>
        <td>ประชุมสี</td><td>-</td>
      </tr>
      <tr>
        <th>พุธ</th>
        <td>ฟิสิกส์เพิ่ม<br>ครูทองแข<br>216(SMAT ม.4)</td>
        <td>ฟิสิกส์เพิ่ม<br>ครูทองแข<br>216(SMAT ม.4)</td>
        <td>แนะแนว<br>ครูธิติมา<br>613</td>
        <td>ภาษาอังกฤษ<br>ครูณัฐพล<br>321</td>
        <td>พักกลางวัน<br>โรงอาหาร</td>
        <td>ชีวะเพิ่ม<br>ครูเจษฎา<br>213</td>
        <td>ชีวะเพิ่ม<br>ครูเจษฎา<br>213</td>
        <td>ว่าง<br>ครู -<br>N/A</td>
        <td>-</td><td>-</td>
      </tr>
      <tr>
        <th>พฤหัสบดี</th>
        <td>คณิตศาสตร์<br>ครูวินัย<br>234</td>
        <td>ภาษาไทย<br>ครูอรทัย<br>627</td>
        <td>คณิตศาสตร์เพิ่ม<br>ครูภณิตา<br>232</td>
        <td>คณิตศาสตร์เพิ่ม<br>ครูภณิตา<br>232</td>
        <td>พักกลางวัน<br>โรงอาหาร</td>
        <td>สังคม<br>ครูนวรัตน์<br>534</td>
        <td>วิทยาศาสตร์โลกและอวกาศ<br>ครูพงศกร<br>433</td>
        <td>ดาราศาสตร์<br>ครูวราภรณ์<br>ชุมนุม</td>
        <td>ซ่อมเสริม</td><td>-</td>
      </tr>
      <tr class="bottom-row">
        <th>ศุกร์</th>
        <td>ฟิสิกส์เพิ่ม<br>ครูทองแข<br>218(SMAT ม.6)</td>
        <td>ฟิสิกส์เพิ่ม<br>ครูทองแข<br>218(SMAT ม.6)</td>
        <td>ประวัติศาสตร์<br>ครูธาราวุฒิ<br>536</td>
        <td>ภาษาอังกฤษ<br>ครูณัฐพล<br>321</td>
        <td>พักกลางวัน<br>โรงอาหาร</td>
        <td>สังคม<br>ครูนวรัตน์<br>534</td>
        <td>ดนตรี<br>ครูสุเมธ<br>311</td>
        <td>English Addon<br>ครูMbah Kingsley<br>328</td>
        <td>-</td><td>-</td>
      </tr>
    </tbody>
  </table>

  <script>
    const digitalClock   = document.getElementById('digital-clock');
    const countdownClock = document.getElementById('countdown-clock');

    const currentSubject = document.getElementById('current-subject');
    const curLabel = document.getElementById('current-slot-label');
    const curProg  = document.getElementById('current-progress');
    const curEta   = document.getElementById('current-time-eta');

    const nextBlock = document.getElementById('next-block');
    const nextLabel = document.getElementById('next-slot-label');
    const nextAfter = document.getElementById('next-after');
    const nextProg  = document.getElementById('next-progress');
    const nextEta   = document.getElementById('next-time-eta');

    const PREVIEW_MIN = 10;
    const PREVIEW_SEC = PREVIEW_MIN * 60;

    const periods = [
      { start: [8, 30], end: [9, 20] },
      { start: [9, 20], end: [10, 10] },
      { start: [10, 20], end: [11, 10] },
      { start: [11, 10], end: [12, 0] },
      { start: [12, 0], end: [12, 50] },
      { start: [12, 50], end: [13, 40] },
      { start: [13, 50], end: [14, 40] },
      { start: [14, 40], end: [15, 30] },
      { start: [15, 30], end: [16, 20] },
      { start: [16, 20], end: [17, 10] }
    ];

    /* ===== Utils ===== */
    function toMinutes(h,m,s=0){ return h*60 + m + s/60; }
    function hmToMinutes([h,m]){ return h*60 + m; }
    function formatHMM(minsFloat){
      const totalMin = Math.floor(minsFloat);
      const h = Math.floor(totalMin/60);
      const m = totalMin%60;
      return h.toString().padStart(2,'0') + ':' + m.toString().padStart(2,'0');
    }
    function formatMMSS(seconds){
      const s = Math.max(0, Math.ceil(seconds));
      const mPart = Math.floor(s/60).toString().padStart(2,'0');
      const sPart = (s%60).toString().padStart(2,'0');
      return `${mPart}:${sPart}`;
    }
    function lerp(a,b,t){ return a + (b-a)*t; }
    // Sky blue -> red
    function colorForRemaining(sec){
      let t = 1 - Math.min(Math.max(sec, 0), PREVIEW_SEC) / PREVIEW_SEC; // 0 .. 1
      const from = {r: 3, g: 223, b: 252};   // #03dffc
      const to   = {r: 255, g: 59, b: 48};   // #ff3b30
      const r = Math.round(lerp(from.r,to.r,t));
      const g = Math.round(lerp(from.g,to.g,t));
      const b = Math.round(lerp(from.b,to.b,t));
      return `rgb(${r}, ${g}, ${b})`;
    }
    function formatCell(cell){
      const raw = (cell.innerText || cell.textContent || '').trim();
      const parts = raw.split(/\s*[\r\n]+\s*/).map(s=>s.trim()).filter(Boolean);
      return parts.join(' ').replace(/\s+/g,' ');
    }

    /* ===== Timeline building (include short breaks) ===== */
    function buildSegments(row){
      const segs = [];
      for(let i=0;i<periods.length;i++){
        const p = periods[i];
        const start = hmToMinutes(p.start);
        const end   = hmToMinutes(p.end);
        const cell  = row.cells[i+1];
        const label = (cell && cell.textContent.trim() && cell.textContent.trim()!=='-') ? formatCell(cell) : 'ว่าง';
        const isLunch = /พักกลางวัน/.test(label);
        const type = isLunch ? 'lunch' : 'class';
        segs.push({type, start, end, label});

        if(i<periods.length-1){
          const nextStart = hmToMinutes(periods[i+1].start);
          if(end < nextStart){
            segs.push({type:'break', start:end, end:nextStart, label:'พักระยะสั้น'});
          }
        }
      }
      segs.sort((a,b)=>a.start-b.start);
      return segs;
    }
    function findCurrentSegment(segs, nowMin){
      for(let i=0;i<segs.length;i++){
        if(nowMin>=segs[i].start && nowMin<segs[i].end) return i;
      }
      return -1;
    }

    /* ===== NEXT BOX (label/progress) ===== */
    function nextLabelText(seg){
      if(!seg) return '-';
      if(seg.type==='lunch') return 'ถัดไป: พักกลางวัน';
      if(seg.type==='break') return 'ถัดไป: พักระยะสั้น';
      return `ถัดไป: ${seg.label}`;
    }
    function afterBreakText(seg){
      if(!seg) return '';
      if(seg.type==='lunch') return 'หลังจากนั้น: พักกลางวัน';
      if(seg.type==='break') return 'หลังจากนั้น: พักระยะสั้น';
      return `หลังจากนั้น: ${seg.label}`;
    }
    function updateNextBox(segs, nowMin){
      const upcomingIndex = segs.findIndex(s => nowMin < s.start);
      const next = upcomingIndex !== -1 ? segs[upcomingIndex] : null;

      nextLabel.textContent = nextLabelText(next);
      nextAfter.style.display = 'none';
      if(next){
        nextEta.textContent = `เริ่มเวลา ${formatHMM(next.start)}`;
        if(next.type==='break'){
          const after = (upcomingIndex+1<segs.length)?segs[upcomingIndex+1]:null;
          const t = afterBreakText(after);
          if(t){ nextAfter.style.display=''; nextAfter.textContent = t; }
        }
      } else {
        nextEta.textContent = 'เริ่มเวลา --:--';
      }

      // อัปเดต progress (แถบ 10 นาที)
      if(!next){ nextProg.style.width='0%'; return; }
      const diffSec = Math.max(0, (next.start - nowMin)*60);
      if(diffSec > PREVIEW_SEC){
        nextProg.style.width='0%';
      } else {
        const pct = (PREVIEW_SEC - diffSec) / PREVIEW_SEC * 100;
        nextProg.style.width = Math.min(100, Math.max(0, pct)) + '%';
      }
    }

    /* ===== COUNTDOWN CLOCK (บล็อกนาฬิกาแยก) ===== */
    function updateCountdownClock(segs, nowMin){
      const upcomingIndex = segs.findIndex(s => nowMin < s.start);
      const next = upcomingIndex !== -1 ? segs[upcomingIndex] : null;

      if(!next){
        // ไม่มีคาบ/ช่วงถัดไปวันนี้
        countdownClock.textContent = '--:--';
        countdownClock.style.color = '#ff3b30';
        countdownClock.style.boxShadow = '0 0 20px rgba(255,59,48,0.9)';
        countdownClock.classList.remove('blink');
        return;
      }

      const diffSec = Math.max(0, (next.start - nowMin)*60);
      if(diffSec === 0){
        countdownClock.textContent = '00:00';
        countdownClock.style.color = '#ff3b30';
        countdownClock.style.boxShadow = '0 0 20px rgba(255,59,48,0.9)';
        countdownClock.classList.add('blink');
        return;
      }

      if(diffSec > PREVIEW_SEC){
        // นอกหน้าต่าง 10 นาที
        countdownClock.textContent = '--:--';
        countdownClock.style.color = '#ff3b30';
        countdownClock.style.boxShadow = '0 0 20px rgba(255,59,48,0.9)';
        countdownClock.classList.remove('blink');
      } else {
        // ใน 10 นาทีสุดท้าย: แสดงเวลาจริง + ไล่สี
        countdownClock.textContent = formatMMSS(diffSec);
        const c = colorForRemaining(diffSec);
        countdownClock.style.color = c;
        // แปลง rgb(...) -> rgba(...,0.9) แบบง่าย
        countdownClock.style.boxShadow = `0 0 20px ${c.replace('rgb','rgba').replace(')',',0.9)')}`;
        if(diffSec <= 30){ countdownClock.classList.add('blink'); } else { countdownClock.classList.remove('blink'); }
      }
    }

    /* ===== CURRENT BLOCK ===== */
    function updateCurrentBlock(segs, idx, nowMin){
      document.querySelectorAll('td').forEach(td=>td.classList.remove('highlighted'));

      if(idx === -1){
        curLabel.textContent = 'ขณะนี้ไม่มีคาบเรียน';
        curProg.style.width = '0%';
        curEta.textContent = '';
        currentSubject.textContent = 'ขณะนี้ไม่มีคาบเรียน';
        return;
      }

      const cur = segs[idx];
      const durMin = cur.end - cur.start;
      const elapsedMin = Math.max(0, nowMin - cur.start);
      const remainMin  = Math.max(0, cur.end - nowMin);
      const pct = Math.min(100, Math.max(0, (elapsedMin / durMin) * 100));

      if(cur.type === 'lunch'){
        curLabel.textContent = 'ช่วงพัก: พักกลางวัน';
        currentSubject.textContent = 'ขณะนี้: พักกลางวัน';
      } else {
        curLabel.textContent = `คาบปัจจุบัน: ${cur.label}`;
        currentSubject.textContent = 'ขณะนี้เรียน: ' + cur.label;
      }
      curProg.style.width = pct + '%';
      curEta.textContent = `เหลือเวลา ${formatMMSS(remainMin*60)} (สิ้นสุด ${formatHMM(cur.end)})`;

      // ไฮไลต์เซลล์หากเป็นคาบเรียน
      const tbody = document.querySelector('tbody');
      const dayIdx = new Date().getDay();
      const rowIndex = dayIdx - 1;
      if(!(dayIdx===0 || dayIdx===6 || !tbody.rows[rowIndex])){
        if(cur.type === 'class'){
          for(let i=0;i<periods.length;i++){
            const pStart = hmToMinutes(periods[i].start);
            const pEnd   = hmToMinutes(periods[i].end);
            if(cur.start===pStart && cur.end===pEnd){
              const cell = tbody.rows[rowIndex].cells[i+1];
              if(cell) cell.classList.add('highlighted');
              break;
            }
          }
        }
      }
    }

    /* ===== Main tick ===== */
    function tick(){
      const now = new Date();
      const h = now.getHours(), m = now.getMinutes(), s = now.getSeconds();

      // นาฬิกาจริง
      digitalClock.textContent =
        h.toString().padStart(2,'0') + ':' +
        m.toString().padStart(2,'0') + ':' +
        s.toString().padStart(2,'0');

      const dayIdx = now.getDay(); // 0-6
      const tbody  = document.querySelector('tbody');
      const rowIndex = dayIdx - 1; // Monday=0

      // วันหยุด: current ไม่มี / next ไม่ทำนายข้ามวัน
      if(dayIdx===0 || dayIdx===6 || !tbody.rows[rowIndex]){
        currentSubject.textContent = 'ขณะนี้ไม่มีคาบเรียน (วันหยุด)';
        curLabel.textContent = 'ขณะนี้ไม่มีคาบเรียน (วันหยุด)';
        curProg.style.width = '0%';
        curEta.textContent = '';

        // Countdown (เซ็ตเป็น --:--)
        countdownClock.textContent = '--:--';
        countdownClock.style.color = '#ff3b30';
        countdownClock.style.boxShadow = '0 0 20px rgba(255,59,48,0.9)';
        countdownClock.classList.remove('blink');

        // Next box (ไม่คาดการณ์ข้ามวัน)
        nextLabel.textContent = '-';
        nextAfter.style.display = 'none';
        nextEta.textContent = 'เริ่มเวลา --:--';
        nextProg.style.width = '0%';
        return;
      }

      const row = tbody.rows[rowIndex];
      const segs = buildSegments(row);
      const nowMin = toMinutes(h,m,s);
      const idx = findCurrentSegment(segs, nowMin);

      updateCurrentBlock(segs, idx, nowMin);
      updateNextBox(segs, nowMin);
      updateCountdownClock(segs, nowMin);
    }

    setInterval(tick, 1000);
    tick();
  </script>

</body>
</html>
