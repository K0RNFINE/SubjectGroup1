<!DOCTYPE html>
<html lang="th">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ตารางเรียน ม.5/1</title>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background-image: url('jpcity.jfif');
      background-size: cover;
      background-position: center;
      background-attachment: fixed;
      padding: 20px;
      margin: 0;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    h1 {
      text-align: center;
      color: #fff; /* หัวข้อในหน้าเป็นสีขาว */
      text-shadow: 0 2px 6px rgba(0, 0, 0, 0.5);
      margin-bottom: 12px;
    }

    .digital-clock {
      font-size: 2rem;
      color: cyan;
      font-family: 'Courier New', Courier, monospace;
      background: rgba(0, 0, 0, 0.7);
      padding: 10px 20px;
      border-radius: 10px;
      box-shadow: 0 0 20px cyan;
      margin-bottom: 8px;
    }

    .current-subject {
      font-size: 1.2rem;
      margin-top: 6px;
      margin-bottom: 12px;
      color: white;
      background-color: rgba(0, 0, 0, 0.6);
      padding: 10px;
      border-radius: 10px;
      text-align: center;
      box-shadow: 0 0 10px white;
    }

    /* Progress bars */
    .progress-wrap {
      width: 100%;
      max-width: 1000px;
      display: grid;
      gap: 10px;
      margin-bottom: 14px;
    }

    .progress-block {
      background: rgba(255, 255, 255, 0.4);
      border: 1px solid rgba(255, 255, 255, 0.6);
      border-radius: 10px;
      padding: 10px;
      box-shadow: 0 6px 16px rgba(0,0,0,0.12);
      backdrop-filter: blur(3px);
    }

    .progress-title {
      font-weight: 700;
      margin-bottom: 6px;
      color: #103a71;
    }

    .progress-subtitle {
      font-size: 0.95rem;
      margin-bottom: 6px;
      color: #0b2447;
    }

    .progress-bar {
      width: 100%;
      height: 12px;
      border-radius: 999px;
      background: rgba(0,0,0,0.15);
      overflow: hidden;
      position: relative;
    }

    .progress-fill {
      height: 100%;
      width: 0%;
      background: linear-gradient(90deg, rgba(79,129,199,1), rgba(0,132,255,1));
      border-radius: 999px;
      transition: width 0.3s ease;
    }

    .progress-time {
      margin-top: 6px;
      font-size: 0.9rem;
      color: #103a71;
    }

    table {
      border-collapse: collapse;
      width: 100%;
      table-layout: fixed;
      background: rgba(255, 255, 255, 0.4);
      border-radius: 10px;
      overflow: hidden;
      box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
    }

    th, td {
      border: 1px solid rgba(255, 255, 255, 0.6);
      padding: 12px;
      text-align: center;
      background-color: rgba(255, 255, 255, 0.4);
    }

    th {
      background-color: #4f81c7;
      color: white;
    }

    .highlighted {
      background-color: rgba(0, 132, 255, 0.4) !important;
      transform: scale(1.1);
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.15);
      z-index: 1;
      position: relative;
    }

    @media only screen and (max-width: 768px) {
      table {
        font-size: 0.9rem;
      }
      .progress-title, .progress-subtitle, .progress-time {
        text-align: center;
      }
    }
  </style>
</head>

<body>
  <h1>ตารางเรียน ม.5/1 กลุ่ม 3 ภาคเรียนที่ 2/2568</h1>

  <div class="digital-clock" id="digital-clock">00:00:00</div>

  <!-- Progress bars -->
  <div class="progress-wrap">
    <div class="progress-block">
      <div class="progress-title">ช่วงเวลาปัจจุบัน</div>
      <div class="progress-subtitle" id="current-slot-label">ขณะนี้ไม่มีคาบเรียน</div>
      <div class="progress-bar"><div class="progress-fill" id="current-progress"></div></div>
      <div class="progress-time" id="current-time-eta"></div>
    </div>

    <div class="progress-block" id="next-block" style="display:none;">
      <div class="progress-title">กำลังจะถึง (จะแสดงล่วงหน้า 10 นาที)</div>
      <div class="progress-subtitle" id="next-slot-label">-</div>
      <div class="progress-bar"><div class="progress-fill" id="next-progress"></div></div>
      <div class="progress-time" id="next-time-eta"></div>
    </div>
  </div>

  <div class="current-subject" id="current-subject">ขณะนี้ไม่มีคาบเรียน</div>

  <table>
    <thead>
      <tr>
        <th>วัน/เวลา</th>
        <th>08.30-09.20</th>
        <th>09.20-10.10</th>
        <th>10.20-11.10</th>
        <th>11.10-12.00</th>
        <th>12.00-12.50</th>
        <th>12.50-13.40</th>
        <th>13.50-14.40</th>
        <th>14.40-15.30</th>
        <th>15.30-16.20</th>
        <th>16.20-17.10</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <th>จันทร์</th>
        <td data-message="ครูภณิตา ห้อง 232">คณิตศาสตร์เพิ่ม<br>ครูภณิตา<br>232</td>
        <td data-message="ครูภณิตา ห้อง 232">คณิตศาสตร์เพิ่ม<br>ครูภณิตา<br>232</td>
        <td data-message="ครูอชิร ห้อง 332">Ind Study<br>ครูอชิร<br>332</td>
        <td data-message="ครูอชิร ห้อง 322">Ind Study<br>ครูอชิร<br>332</td>
        <td data-message="ไปกินข้าว">พักกลางวัน<br>โรงอาหาร</td>
        <td data-message="ครูกัลยา ห้อง 432">เคมีเพิ่มเติม<br>ครูกัลยา<br>432</td>
        <td data-message="ครูกัลยา ห้อง 432">เคมีเพิ่มเติม<br>ครูกัลยา<br>432</td>
        <td data-message="ร้อยตรีวัชชัย ห้อง ฝึกงาน2">การงานอาชีพ<br>ร้อยตรีวัชชัย<br>ฝึกงาน2</td>
        <td>-</td>
        <td>-</td>
      </tr>
      <tr>
        <th>อังคาร</th>
        <td data-message="ครูพงศกร ห้อง 433">วิทยาศาสตร์โลกและอวกาศ<br>ครูพงศกร(เพชร)<br>433</td>
        <td data-message="ครูพงศกร ห้อง 433">วิทยาศาสตร์โลกและอวกาศ<br>ครูพงศกร(เพชร)<br>433</td>
        <td data-message="ครูกัลยา ห้อง 432">เคมีเพิ่มเติม<br>ครูกัลยา<br>432</td>
        <td data-message="ครูเจษฎา ห้อง 213">ชีวะเพิ่ม<br>ครูเจษฎา<br>213</td>
        <td data-message="ไปกินข้าว">พักกลางวัน<br>โรงอาหาร</td>
        <td data-message="ครูอรทัย ห้อง 627">ภาษาไทย<br>ครูอรทัย<br>627</td>
        <td data-message="ครูวินัย ห้อง 234">คณิตศาสตร์<br>ครูวินัย<br>234</td>
        <td data-message="ครูนฤมิต ห้อง อเนกประสงค์5">สุขะพละ<br>ครูนฤมิต<br>อเนกประสงค์5</td>
        <td>ประชุมสี</td>
        <td>-</td>
      </tr>
      <tr>
        <th>พุธ</th>
        <td data-message="ครูทองแข ห้อง 216">ฟิสิกส์เพิ่ม<br>ครูทองแข<br>216</td>
        <td data-message="ครูทองแข ห้อง 216">ฟิสิกส์เพิ่ม<br>ครูทองแข<br>216</td>
        <td data-message="ครูธิติมา ห้อง 613">แนะแนว<br>ครูธิติมา<br>613</td>
        <td data-message="ครูณัฐพล ห้อง 321">ภาษาอังกฤษ<br>ครูณัฐพล<br>321</td>
        <td data-message="ไปกินข้าว">พักกลางวัน<br>โรงอาหาร</td>
        <td data-message="ครูเจษฎา ห้อง 213">ชีวะเพิ่ม<br>ครูเจษฎา<br>213</td>
        <td data-message="ครูเจษฎา ห้อง 213">ชีวะเพิ่ม<br>ครูเจษฎา<br>213</td>
        <td data-message="ว่าง">ว่าง<br>ครู -<br>N/A</td>
        <td>-</td>
        <td>-</td>
      </tr>
      <tr>
        <th>พฤหัสบดี</th>
        <td data-message="ครูวินัย ห้อง 234">คณิตศาสตร์<br>ครูวินัย<br>234</td>
        <td data-message="ครูอรทัย ห้อง 627">ภาษาไทย<br>ครูอรทัย<br>627</td>
        <td data-message="ครูภณิตา ห้อง 232">คณิตศาสตร์เพิ่ม<br>ครูภณิตา<br>232</td>
        <td data-message="ครูภณิตา ห้อง 232">คณิตศาสตร์เพิ่ม<br>ครูภณิตา<br>232</td>
        <td data-message="ไปกินข้าว">พักกลางวัน<br>โรงอาหาร</td>
        <td data-message="ครูนวรัตน์ ห้อง 534">สังคม<br>ครูนวรัตน์<br>534</td>
        <td data-message="ครูพงศกร ห้อง 433">วิทยาศาสตร์โลกและอวกาศ<br>ครูพงศกร<br>433</td>
        <td data-message="ครูวราภรณ์ ห้อง ชมนุม">ดาราศาสตร์<br>ครูวราภรณ์<br>ชุมนุม</td>
        <td>ซ่อมเสริม</td>
        <td>-</td>
      </tr>
      <tr class="bottom-row">
        <th>ศุกร์</th>
        <td data-message="ครูทองแข ห้อง 218">ฟิสิกส์เพิ่ม<br>ครูทองแข<br>218</td>
        <td data-message="ครูทองแข ห้อง 218">ฟิสิกส์เพิ่ม<br>ครูทองแข<br>218</td>
        <td data-message="ครูธาราวุฒิ ห้อง 536">ประวัติศาสตร์<br>ครูธาราวุฒิ<br>536</td>
        <td data-message="ครูณัฐพล ห้อง 321">ภาษาอังกฤษ<br>ครูณัฐพล<br>321</td>
        <td data-message="ไปกินข้าว">พักกลางวัน<br>โรงอาหาร</td>
        <td data-message="ครูนวรัตน์ ห้อง 534">สังคม<br>ครูนวรัตน์<br>534</td>
        <td data-message="ครูสุเมธ ห้อง 311">ดนตรี<br>ครูสุเมธ<br>311</td>
        <td data-message="ครูMbah Kingsley ห้อง 328">English Addon<br>ครูMbah Kingsley<br>328</td>
        <td>-</td>
        <td>-</td>
      </tr>
    </tbody>
  </table>

  <!-- 🧠 SCRIPT SECTION -->
  <script>
    const digitalClock = document.getElementById('digital-clock');
    const currentSubject = document.getElementById('current-subject');
    const curLabel = document.getElementById('current-slot-label');
    const curProg = document.getElementById('current-progress');
    const curEta = document.getElementById('current-time-eta');
    const nextBlock = document.getElementById('next-block');
    const nextLabel = document.getElementById('next-slot-label');
    const nextProg = document.getElementById('next-progress');
    const nextEta = document.getElementById('next-time-eta');

    const PREVIEW_MIN = 10; // แสดงคาบถัดไปล่วงหน้า 10 นาที

    const periods = [
      { start: [8, 30], end: [9, 20] },
      { start: [9, 20], end: [10, 10] },
      { start: [10, 20], end: [11, 10] },
      { start: [11, 10], end: [12, 0] },
      { start: [12, 0], end: [12, 50] },
      { start: [12, 50], end: [13, 40] },
      { start: [13, 50], end: [14, 40] },
      { start: [14, 40], end: [15, 30] },
      { start: [15, 30], end: [16, 20] },
      { start: [16, 20], end: [17, 10] }
    ];

    // จัดข้อความให้เว้นวรรคเดียวระหว่าง "วิชา ครู ห้อง"
    function formatCell(cell) {
      const raw = (cell.innerText || cell.textContent || '').trim();
      const parts = raw.split(/\s*[\r\n]+\s*/).map(s => s.trim()).filter(Boolean);
      return parts.join(' ').replace(/\s+/g, ' ');
    }

    function toMinutes(h, m) { return h * 60 + m; }
    function fromMinutes(mins) {
      const h = Math.floor(mins / 60), m = mins % 60;
      return h.toString().padStart(2, '0') + ':' + m.toString().padStart(2, '0');
    }

    // สร้าง "ช่วงเวลา" ของวันนี้ (รวมเวลาพักระหว่างคาบ)
    function buildSegments(row) {
      const segs = [];
      for (let i = 0; i < periods.length; i++) {
        const p = periods[i];
        const start = toMinutes(p.start[0], p.start[1]);
        const end = toMinutes(p.end[0], p.end[1]);
        const cell = row.cells[i + 1];
        const label = (cell && cell.textContent.trim() && cell.textContent.trim() !== '-') ? formatCell(cell) : 'ว่าง';
        const isBreakLike = /พักกลางวัน/.test(label);
        segs.push({ type: isBreakLike ? 'break' : 'class', start, end, label });

        // แทรก "พักระยะสั้น" ถ้าช่องว่างระหว่างคาบ > 0 (และไม่ทับกับช่วงพักที่อยู่ในตารางอยู่แล้ว)
        if (i < periods.length - 1) {
          const nextStart = toMinutes(periods[i + 1].start[0], periods[i + 1].start[1]);
          if (end < nextStart) {
            segs.push({ type: 'break', start: end, end: nextStart, label: 'พักระยะสั้น' });
          }
        }
      }
      // เรียงเผื่อมีการสอดแทรก
      segs.sort((a, b) => a.start - b.start);
      return segs;
    }

    function findCurrentSegment(segs, nowMin) {
      for (let i = 0; i < segs.length; i++) {
        if (nowMin >= segs[i].start && nowMin < segs[i].end) {
          return i;
        }
      }
      return -1;
    }

    function updateProgressBars(segs, idx, nowMin) {
      // ล้างไฮไลต์ในตารางก่อน
      document.querySelectorAll('td').forEach(td => td.classList.remove('highlighted'));

      if (idx === -1) {
        curLabel.textContent = 'ขณะนี้ไม่มีคาบเรียน';
        curProg.style.width = '0%';
        curEta.textContent = '';
        nextBlock.style.display = 'none';
        currentSubject.textContent = 'ขณะนี้ไม่มีคาบเรียน';
        return;
      }

      const cur = segs[idx];
      const dur = cur.end - cur.start;
      const elapsed = Math.max(0, nowMin - cur.start);
      const remain = Math.max(0, cur.end - nowMin);
      const pct = Math.min(100, Math.max(0, (elapsed / dur) * 100));

      // อัปเดต label ปัจจุบัน + ไฮไลต์คาบในตารางถ้าเป็นคาบเรียน
      curLabel.textContent = (cur.type === 'break') ? `ช่วงพัก: ${cur.label}` : `คาบปัจจุบัน: ${cur.label}`;
      curProg.style.width = pct + '%';
      curEta.textContent = `เหลือเวลา ${remain} นาที (สิ้นสุด ${fromMinutes(cur.end)})`;

      // อัปเดตกล่อง "ขณะนี้เรียน/คาบถัดไป" ด้านล่างตาราง
      const tbody = document.querySelector('tbody');
      const dayIdx = new Date().getDay();
      const rowIndex = dayIdx - 1;
      if (dayIdx === 0 || dayIdx === 6 || !tbody.rows[rowIndex]) {
        currentSubject.textContent = 'ขณะนี้ไม่มีคาบเรียน (วันหยุด)';
      } else {
        // ค้นหา cell ที่ตรงกับเวลาปัจจุบันเพื่อใส่ไฮไลต์ (เฉพาะคาบเรียน)
        if (cur.type === 'class') {
          // หา index คาบเพื่อ map กับ cell: ใช้เวลาของ periods เทียบ
          for (let i = 0; i < periods.length; i++) {
            const pStart = toMinutes(periods[i].start[0], periods[i].start[1]);
            const pEnd = toMinutes(periods[i].end[0], periods[i].end[1]);
            if (cur.start === pStart && cur.end === pEnd) {
              const cell = tbody.rows[rowIndex].cells[i + 1];
              if (cell) cell.classList.add('highlighted');
              break;
            }
          }
          currentSubject.textContent = 'ขณะนี้เรียน: ' + cur.label;
        } else {
          currentSubject.textContent = 'ขณะนี้: ' + cur.label;
        }
      }

      // คำนวณคาบถัดไป
      const next = (idx + 1 < segs.length) ? segs[idx + 1] : null;
      if (!next) {
        nextBlock.style.display = 'none';
        return;
      }

      // แสดง “ถัดไป” เมื่อเหลือเวลาไม่เกิน PREVIEW_MIN นาทีในช่วงปัจจุบัน
      if (remain <= PREVIEW_MIN) {
        nextBlock.style.display = '';
        const nextText = (next.type === 'break') ? `ถัดไป: พักระยะสั้น` : `ถัดไป: ${next.label}`;
        nextLabel.textContent = nextText;

        // progress ของแถบถัดไป = ความคืบหน้าในหน้าต่าง 10 นาทีสุดท้าย
        const previewElapsed = PREVIEW_MIN - remain; // 0..10
        const nextPct = Math.min(100, Math.max(0, (previewElapsed / PREVIEW_MIN) * 100));
        nextProg.style.width = nextPct + '%';
        nextEta.textContent = `เริ่มเวลา ${fromMinutes(next.start)} (อีก ${remain} นาที)`;
      } else {
        nextBlock.style.display = 'none';
      }
    }

    function updateClock() {
      const now = new Date();
      const h = now.getHours();
      const m = now.getMinutes();
      const s = now.getSeconds();
      digitalClock.textContent =
        h.toString().padStart(2, '0') + ':' +
        m.toString().padStart(2, '0') + ':' +
        s.toString().padStart(2, '0');

      updateState(h, m);
    }

    function updateState(hour, minute) {
      const dayIdx = new Date().getDay(); // 0-6
      const tbody = document.querySelector('tbody');
      const rowIndex = dayIdx - 1; // Monday=0
      // วันหยุด
      if (dayIdx === 0 || dayIdx === 6 || !tbody.rows[rowIndex]) {
        updateProgressBars([], -1, 0);
        return;
      }

      const row = tbody.rows[rowIndex];
      const segs = buildSegments(row);
      const nowMin = hour * 60 + minute;
      const idx = findCurrentSegment(segs, nowMin);

      // หากอยู่นอกช่วงเรียนทั้งหมด ให้โชว์ "คาบถัดไป" เฉพาะถ้าอยู่ในหน้าต่าง 10 นาที ก่อนเริ่มคาบแรก
      if (idx === -1) {
        // หา segment แรกที่ยังไม่เริ่ม
        const upcomingIndex = segs.findIndex(s => nowMin < s.start);
        if (upcomingIndex !== -1) {
          const next = segs[upcomingIndex];
          const diff = next.start - nowMin;
          // แสดงเฉพาะช่วง <= 10 นาที ก่อนเริ่ม
          if (diff <= PREVIEW_MIN) {
            nextBlock.style.display = '';
            nextLabel.textContent = (next.type === 'break') ? 'ถัดไป: พักระยะสั้น' : `ถัดไป: ${next.label}`;
            const nextPct = Math.min(100, Math.max(0, ((PREVIEW_MIN - diff) / PREVIEW_MIN) * 100));
            nextProg.style.width = nextPct + '%';
            nextEta.textContent = `เริ่มเวลา ${fromMinutes(next.start)} (อีก ${diff} นาที)`;
          } else {
            nextBlock.style.display = 'none';
          }
        } else {
          nextBlock.style.display = 'none';
        }
        // อัปเดตกล่องหลักให้รู้ว่าไม่มีคาบ
        currentSubject.textContent = 'ขณะนี้ไม่มีคาบเรียน';
        curLabel.textContent = 'ขณะนี้ไม่มีคาบเรียน';
        curProg.style.width = '0%';
        curEta.textContent = '';
        return;
      }

      updateProgressBars(segs, idx, nowMin);
    }

    setInterval(updateClock, 1000);
    updateClock();
  </script>

</body>
</html>
